
# make secure temp dir and set tmp_dir to it
function make_temp_dir {
	tmp_dir=$(mktemp -d -p ${tmp_root} allas-cli-tools-XXXXXX)
}

# remove tmp_dir if it exists
function clean_temp_dir {
	if [ -n "${tmp_dir}" -a -d "${tmp_dir}" ]; then
		rm -rf ${tmp_dir}
	fi	

}

check_swift_connection () {
  test=$(rclone about ${storage_server}: 2> /dev/null | wc -l)

    if [[ $test -lt 1 ]]
    then
      #if [ -n "$ACTIVE_TOKEN" ]; then
      #   unset OS_AUTH_TOKEN
      #   export OS_AUTH_TOKEN=$(check_atoken)
      #   #echo "New  OS_AUTH_TOKEN = $OS_AUTH_TOKEN"
      #fi

    if [[ -n "$OS_PASSWORD" ]]; then
      if  [[ $silent -eq 0 ]] ; then
          echo "Updating token"
      fi
      source $allas_conf_path --user $user -k $OS_PROJECT_NAME -f
    fi
    test=$(swift stat 2> /dev/null | grep -c "Account:")
    if [[ $test -lt 1 ]]
    then
       echo "No connection to Allas!"
       echo "Please try setting up the connection again."
       exit 1
    else
      echo "swift connection updated"
    fi
  else
     echo "swift connection OK"
  fi
}

remove_slash_from_ends(){
path_string=$1
if [[ ${path_string:(-1)} == "/" ]]; then
    path_string=${path_string%/}
fi

if [[  ${path_string:0:1} == "/" ]]; then
    tlen=${#path_string}
    path_string=${path_string:1:tlen}
fi

echo $path_string
}
